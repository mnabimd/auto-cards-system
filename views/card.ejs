<!DOCTYPE html>
<html lang="en">

<head>
    <%- include('partials/head')%>
    <title>Generate new card - KDR University</title>
</head>

<body id="page-top">

    <!-- Page Wrapper -->
    <div id="wrapper">

        <!-- Sidebar -->
        <%- include('partials/sidebar')%>
        <!-- End of Sidebar -->

        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">

            <!-- Main Content -->
            <div id="content">

                <!-- Topbar -->
                <%- include('partials/topbar')%>
                <!-- End of Topbar -->

                <!-- Begin Page Content -->
                <div class="container-fluid">
                    <!-- ---------------------------------------------------------------------- -->
                    <!-- Student Searching Form -->
                    <form action="/newCard" method="POST" style="width: 400px;">

                        <label>Input Student Kankor's ID</label>
                        <div class="input-group">
                            <input class="form-control" type="text" name="kankorId">
                            <input class="btn btn-primary" type="submit" value="Find Student">
                        </div>
                    </form>

                    <!-- Student Result  -->
                    <% if (data.student) {%>
                    <div class="student-bio mx-5 my-3">
                        <div class="card p-5" dir="rtl">
                            <style>
                                #student-profile {
                                    margin-right: auto;
                                    margin-left: auto;
                                    width: 150px;
                                    border-radius: 50%;
                                }
                            </style>
                            <div class="d-flex flex-column align-items-center w-100">
                                <img id="student-profile" src="./card-template/images/images.png">
                            </div>
                            <form action="/cardLive" method="POST" class="font-weight-bold pashtoFont mt-5" enctype="multipart/form-data">
                                
                                <input id="image-uploaded" type="file" class="text-center"
                                    accept="image/x-png,image/gif,image/jpeg" name="profilePhoto" required="Please upload a profile photo!" />

                                <div class="form-row">
                                    <div class="col">
                                        <div class="form-group">
                                            <label for="name" class="pashtoFont float-right"> نوم</label>
                                            <input id="name-kankor" class="form-control my-input" type="text"
                                                name="name" value="<%= data.student.name %>">
                                        </div>
                                    </div>

                                    <div class="col">
                                        <div class="form-group">
                                            <label for="name" class="pashtoFont float-right"> د پلارنوم</label>
                                            <input id="fatherName-kankor" class="form-control my-input" type="text"
                                                name="fatherName" value="<%= data.student.fatherName %>">
                                        </div>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="col">
                                        <div class="form-group">
                                            <label class="pashtoFont float-right "> پوهنځی</label>
                                            <input id="faculty-kankor" class="form-control my-input" type="text"
                                                name="faculty" value="<%= data.student.faculty.name %>">
                                        </div>
                                    </div>

                                    <div class="col">
                                        <div class="form-group">
                                            <label class="pashtoFont float-right"> څانګه</label>
                                            <input id="branch-kankor" class="form-control my-input" type="text"
                                                name="branch" value="<%= data.student.faculty.branch %>">
                                        </div>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="col">
                                        <div class="form-group">
                                            <label class="pashtoFont float-right"> د وینی ګروپ</label>
                                            <input id="blood-kankor" class="form-control my-input" type="text"
                                                name="blood" value="A+">
                                        </div>
                                    </div>

                                    <div class="col">
                                        <div class="form-group">
                                            <label class="pashtoFont float-right"> شاملیدو کال</label>
                                            <input id="yearOfKankor-kankor" class="form-control my-input" type="text"
                                                name="yearOfKankor" value="<%= data.student.yearOfKankor %>">
                                        </div>
                                    </div>

                                    <input id="kankorId" type="text" value="<%= data.student.kankorId%>" name="kankorId"
                                        style="display: none;">

                                </div>

                                <button type="submit" class="btn btn-danger">Live Preview</button>
                                <form method="POST" action="/downloadImage" class="m-2">
                                    <button class="btn btn-primary p2" type="submit">Download Image</button>
                                </form>
                            </form>

                        </div>
                    </div>
                    <%} else if (data.message) {%>
                    <h2><%= data.message %></h2>
                    <%} %>
                    <!-- ---------------------------------------------------------------------- -->
                </div>
                <!-- /.container-fluid -->

            </div>
            <!-- End of Main Content -->

            <!-- Footer -->
            <%- include('partials/footer')%>
            <!-- End of Footer -->

        </div>
        <!-- End of Content Wrapper -->

    </div>
    <!-- End of Page Wrapper -->

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
        <i class="fas fa-angle-up"></i>
    </a>

    <!-- Logout Modal-->
    <%- include('partials/modals/logout')%>

    <!-- Bootstrap core JavaScript-->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for all pages-->
    <script src="js/sb-admin-2.min.js"></script>

    <!-- My Scripts:- -->
    <script src="./js/main/bundle.js"></script>

</body>

<script>
    const toBase64 = file => new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = error => reject(error);
    });


    const elements = {
        studentImage: document.getElementById('student-profile'),
        imageUploaded: document.getElementById('image-uploaded'),
        formInputFileBuffer: document.getElementById('profileBuffer')
    }

    // Change student profile picture with the new updated one!:-
    elements.imageUploaded.addEventListener('change', async (e) => {

        const file = elements.imageUploaded.files[0];
        const fileData = await toBase64(file);

        elements.studentImage.src = fileData

    })
</script>

</html>